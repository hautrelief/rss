<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Events viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:2rem;}
    h1{font-weight:600; font-size:1.25rem}
    .controls{margin-bottom:1rem; display:flex; gap:.5rem; align-items:center}
    table{border-collapse:collapse; width:100%}
    th,td{border:1px solid #ddd; padding:.5rem; vertical-align:top}
    th{background:#f6f6f6; text-align:left}
    tr:nth-child(even){background:#fafafa}
    .muted{color:#666; font-size:.9em}
  </style>
</head>
<body>
  <h1>NemTilmeld events</h1>
  <div class="controls">
    <label>Source XML:</label>
    <input id="src" size="60" value="data_all.xml" />
    <button id="load">Load</button>
  </div>
  <table id="tbl">
    <thead>
      <tr>
        <th>Title</th>
        <th>Start</th>
        <th>End</th>
        <th>Location</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
async function load(xmlUrl){
  const res = await fetch(xmlUrl);
  if(!res.ok) throw new Error("Failed to fetch "+xmlUrl);
  const text = await res.text();
  const doc = new DOMParser().parseFromString(text, "application/xml");

  const rows = [];
  for(const ev of doc.querySelectorAll("data > events > event")){
    const val = tag => (ev.querySelector(tag)?.textContent || "").trim();
    const loc = ev.querySelector("location");
    const locStr = [
      loc?.querySelector("name")?.textContent,
      loc?.querySelector("address")?.textContent,
      [loc?.querySelector("zipcode")?.textContent, loc?.querySelector("city")?.textContent].filter(Boolean).join(" "),
      loc?.querySelector("country")?.textContent
    ].filter(Boolean).join(", ");

    rows.push({
      title: val("title"),
      start: val("start_time_common") || val("start_time"),
      end: val("end_time_common") || val("end_time"),
      loc: locStr,
      url: val("url"),
      orgId: val("org_event_id")
    });
  }

  const tbody = document.querySelector("#tbl tbody");
  tbody.innerHTML = "";
  for(const r of rows){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><strong>${r.title || "(untitled)"} </strong><div class="muted">#${r.orgId||""}</div></td>
      <td>${r.start||""}</td>
      <td>${r.end||""}</td>
      <td>${r.loc||""}</td>
      <td>${r.url ? `<a href="${r.url}" target="_blank" rel="noopener">Open</a>` : ""}</td>
    `;
    tbody.appendChild(tr);
  }
}

document.getElementById("load").onclick = () => load(document.getElementById("src").value);
load(document.getElementById("src").value).catch(e => alert(e.message));
</script>
</body>
</html>
